алг
нач
  цел Nx, Ny, Nz
  Nx := 8
  Ny := 8
  Nz := 8

  вещ pi
  pi := 3.141592653589793
  вещ h, h2
  h := 1.0 / (Nx - 1)
  h2 := h * h

  | Неявная схема (Backward Euler) для u_t = Δu в 3D: (I - dt Δ) u^{n+1} = u^n
  | Итерационно решаем линейную систему методом Гаусса–Зейделя на каждом шаге по времени
  вещ lam, dt, T
  lam := 0.5 | lam = dt / h^2 (умеренно крупный шаг по времени, неявная схема устойчива)
  dt := lam * h2
  T := 0.10

  цел nt
  nt := int(T / dt)
  если nt < 1 то nt := 1 все

  | 4D массив: u[время, x, y, z]
  вещ таб u[0:nt, 0:Nx-1, 0:Ny-1, 0:Nz-1]

  цел i, j, k, n, it, maxIt
  вещ x, y, z, t
  вещ decay, uex, diff, err, rhs, newv, oldv, change, denom

  | Начальное условие u(0,x,y,z) = sin(pi x) sin(pi y) sin(pi z)
  нц для i от 0 до Nx-1 шаг 1
    x := i * h
    нц для j от 0 до Ny-1 шаг 1
      y := j * h
      нц для k от 0 до Nz-1 шаг 1
        z := k * h
        u[0,i,j,k] := sin(pi * x) * sin(pi * y) * sin(pi * z)
      кц
    кц
  кц

  | Граница нулевая для всех t
  maxIt := 200 | максимум внутренних итераций Гаусса–Зейделя на шаг
  denom := 1.0 + 6.0 * lam

  нц для n от 0 до nt-1 шаг 1
    | Инициализируем начальное приближение u[n+1] := u[n]
    нц для i от 0 до Nx-1 шаг 1
      нц для j от 0 до Ny-1 шаг 1
        нц для k от 0 до Nz-1 шаг 1
          u[n+1,i,j,k] := u[n,i,j,k]
        кц
      кц
    кц

    | Внутренние итерации решения (I - dt Δ) u^{n+1} = u^n методом Гаусса–Зейделя
    нц для it от 0 до maxIt-1 шаг 1
      change := 0.0
      нц для i от 1 до Nx-2 шаг 1
        нц для j от 1 до Ny-2 шаг 1
          нц для k от 1 до Nz-2 шаг 1
            oldv := u[n+1,i,j,k]
            rhs := u[n,i,j,k]
            newv := (rhs + lam * (u[n+1,i+1,j,k] + u[n+1,i-1,j,k] + u[n+1,i,j+1,k] + u[n+1,i,j-1,k] + u[n+1,i,j,k+1] + u[n+1,i,j,k-1])) / denom
            u[n+1,i,j,k] := newv
            diff := abs(newv - oldv)
            change := max(change, diff)
          кц
        кц
      кц
      | Ранний выход по сходимости внутреннего решателя
      если change < 1e-6 то выход все
    кц
  кц

  | Оценка ошибки на времени t = nt * dt относительно точного решения e^{-3 pi^2 t} sin(pi x) sin(pi y) sin(pi z)
  t := nt * dt
  decay := exp(-3.0 * pi * pi * t)
  err := 0.0
  нц для i от 0 до Nx-1 шаг 1
    x := i * h
    нц для j от 0 до Ny-1 шаг 1
      y := j * h
      нц для k от 0 до Nz-1 шаг 1
        z := k * h
        uex := decay * sin(pi * x) * sin(pi * y) * sin(pi * z)
        diff := abs(u[nt,i,j,k] - uex)
        err := max(err, diff)
      кц
    кц
  кц

  вывод "Heat3D implicit (4D): N=", Nx, ", T=", t:8:8, ", dt=", dt:8:8, ", max|u-uex|=", err:8:8, "\n"
  если err < 1e-2 то
    вывод "OK\n"
  иначе
    вывод "FAIL\n"
  все
кон
